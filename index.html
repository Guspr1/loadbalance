<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mikrotik PCC V4.7 (Engineer Grade)</title>
<style>
body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:#0f0f13;color:#e0e0e0;margin:0;padding:20px}
*{box-sizing:border-box}
.c{max-width:900px;margin:0 auto;background:#18181b;border:1px solid #27272a;border-radius:12px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.5)}
.h{padding:30px;text-align:center;border-bottom:1px solid #27272a;background:linear-gradient(to bottom, #27272a 0%, #18181b 100%)}
h2{margin:0;color:#fff;font-size:24px;letter-spacing:-0.5px}
.sub{color:#10b981;font-size:12px;font-weight:700;letter-spacing:1.5px;margin-top:8px;text-transform:uppercase}
.t{display:flex;background:#27272a;padding:4px;gap:4px}
.tb{flex:1;padding:12px;cursor:pointer;background:transparent;border:none;color:#71717a;font-weight:600;font-size:14px;border-radius:6px;transition:all 0.2s}
.tb:hover{color:#fff;background:#3f3f46}
.tb.a{background:#10b981;color:#000;box-shadow:0 4px 6px -1px rgba(16, 185, 129, 0.2)}
.p{padding:30px;display:none}
.p.a{display:block}
.r{display:flex;gap:12px;margin-bottom:12px;background:#27272a;padding:16px;border-radius:8px;border:1px solid #3f3f46;align-items:flex-end}
.g{flex:1}
label{display:block;font-size:11px;color:#a1a1aa;margin-bottom:6px;font-weight:600;text-transform:uppercase}
input{width:100%;background:#09090b;border:1px solid #3f3f46;color:#fff;padding:10px;border-radius:6px;font-size:13px;transition:border 0.2s}
input:focus{border-color:#10b981;outline:none}
.btn{padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:13px;transition:transform 0.1s}
.btn:active{transform:scale(0.98)}
.ba{width:100%;background:#10b981;color:#000;margin-top:10px}
.bd{background:#ef4444;color:#fff;width:40px;display:flex;justify-content:center;align-items:center}
.bg{width:100%;background:#3b82f6;color:#fff;margin-top:10px;padding:16px;font-size:14px}
.bc{width:100%;background:#22c55e;color:#000;margin-top:10px}
.rg{display:flex;gap:20px;margin-bottom:24px;background:#27272a;padding:16px;border-radius:8px;border:1px solid #3f3f46;align-items:center}
.ro{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;font-weight:500}
.sep{width:1px;height:24px;background:#3f3f46;margin:0 10px}
textarea{width:100%;height:450px;background:#09090b;color:#a1a1aa;border:1px solid #3f3f46;padding:16px;margin-top:16px;border-radius:8px;resize:vertical;font-family:'JetBrains Mono', 'Fira Code', monospace;font-size:12px;line-height:1.5}
.st-bar{background:#27272a;padding:12px;border-radius:6px;margin-bottom:16px;font-family:monospace;font-size:12px;color:#10b981;border:1px solid #3f3f46}
.f{padding:20px;text-align:center;border-top:1px solid #27272a;background:#18181b;font-size:12px;color:#71717a}
input[type="checkbox"] {accent-color: #10b981;}
/* Saweria Button Style */
.don{display:inline-block;background:#eab308;color:#000;padding:10px 25px;border-radius:50px;font-weight:800;text-decoration:none;margin-top:15px;font-size:13px;transition:all 0.2s;border:2px solid #eab308}
.don:hover{background:transparent;color:#eab308;box-shadow:0 0 15px rgba(234, 179, 8, 0.3)}
</style>
</head>
<body>

<div class="c">
  <div class="h">
    <h2>MIKROTIK PCC GENERATOR</h2>
    <div class="sub">V4.7 ENGINEER GRADE (PURIST)</div>
  </div>

  <div class="t">
    <button class="tb a" onclick="_x('p1',this)">1. WAN & BANDWIDTH</button>
    <button class="tb" onclick="_x('p2',this)">2. LOCAL NETWORK</button>
    <button class="tb" onclick="_x('p3',this)">3. GENERATE</button>
  </div>

  <div id="p1" class="p a">
    <div class="rg">
      <div style="color:#10b981;font-weight:700">ROUTER OS:</div>
      <label class="ro"><input type="radio" name="ros" value="v6"> v6 (Legacy)</label>
      <label class="ro"><input type="radio" name="ros" value="v7" checked> v7 (Modern)</label>
      <div class="sep"></div>
      <label class="ro" title="Centang jika Gateway semua ISP sama (192.168.1.1)">
        <input type="checkbox" id="sgw" checked> Fix Same-Gateway
      </label>
    </div>

    <div id="lw">
      <div class="r">
        <div class="g"><label>Interface Name</label><input class="if" value="ether1-ISP1"></div>
        <div class="g"><label>IP Address</label><input class="ip" value="192.168.10.2/24"></div>
        <div class="g"><label>Gateway IP</label><input class="gw" value="192.168.10.1"></div>
        <div class="g" style="flex:.4"><label>Speed (Mb)</label><input type="number" class="bw" value="20"></div>
        <button class="btn bd" onclick="_z(this)">√ó</button>
      </div>
      <div class="r">
        <div class="g"><label>Interface Name</label><input class="if" value="ether2-ISP2"></div>
        <div class="g"><label>IP Address</label><input class="ip" value="192.168.20.2/24"></div>
        <div class="g"><label>Gateway IP</label><input class="gw" value="192.168.20.1"></div>
        <div class="g" style="flex:.4"><label>Speed (Mb)</label><input type="number" class="bw" value="100"></div>
        <button class="btn bd" onclick="_z(this)">√ó</button>
      </div>
    </div>
    <button class="btn ba" onclick="_aw()">+ ADD WAN CONNECTION</button>
  </div>

  <div id="p2" class="p">
    <div id="ll">
      <div class="r">
        <div class="g"><label>LAN Interface</label><input class="lif" value="bridge-local"></div>
        <div class="g"><label>LAN Network (CIDR)</label><input class="lip" value="192.168.88.0/24"></div>
        <button class="btn bd" onclick="_z(this)">√ó</button>
      </div>
    </div>
    <button class="btn ba" onclick="_al()">+ ADD LAN NETWORK</button>
  </div>

  <div id="p3" class="p">
    <div id="st" class="st-bar">Ready to generate...</div>
    <button class="btn bg" onclick="_gn()">GENERATE SCRIPT (ENGINEER MODE)</button>
    <textarea id="ou" readonly placeholder="Script output will appear here..."></textarea>
    <button class="btn bc" onclick="_cp()">COPY TO CLIPBOARD</button>
  </div>

  <div class="f">
    Code Logic by <b>Muhammad Bagus Pribadi</b><br>
    Validated for Production Use<br><br>
    <a href="https://saweria.co/SigmaRule" target="_blank" class="don">üéÅ Support Developer (Saweria)</a>
  </div>
</div>

<script>
(function(){
const _0x5a2f=['document','querySelectorAll','getElementById','input[name="ros"]:checked','.p','.tb','a','classList','remove','add','value','trim','length','.r','#lw','#ll','.if','.ip','.gw','.bw','.lif','.lip','Data incomplete!','LOC','WAN_LIST','LAN_LIST','fasttrack-connection','both-addresses-and-ports','v7','v6','Start PCC V4.7 (Purist)','Copied!','%','conn_','to_'];
const _=(i)=>_0x5a2f[i];
const D=window[_('0')];
const Q=(s)=>D[_('1')](s);
const I=(s)=>D[_('2')](s);

window._x=function(i,e){
Q(_(4)).forEach(x=>x[_('7')][_('8')](_(6)));
Q(_(5)).forEach(x=>x[_('7')][_('8')](_(6)));
I(i)[_('7')][_('9')](_(6));
e[_('7')][_('9')](_(6));
};
window._z=function(e){confirm('Remove this line?')&&e.parentElement.remove();};
window._aw=function(){
let d=D.createElement('div');d.className='r';
d.innerHTML='<div class="g"><label>Interface Name</label><input class="if"></div><div class="g"><label>IP Address</label><input class="ip"></div><div class="g"><label>Gateway IP</label><input class="gw"></div><div class="g" style="flex:.4"><label>Speed (Mb)</label><input type="number" class="bw" value="20"></div><button class="btn bd" onclick="_z(this)">√ó</button>';
I('lw').appendChild(d);
};
window._al=function(){
let d=D.createElement('div');d.className='r';
d.innerHTML='<div class="g"><label>Interface</label><input class="lif"></div><div class="g"><label>Network CIDR</label><input class="lip"></div><button class="btn bd" onclick="_z(this)">√ó</button>';
I('ll').appendChild(d);
};
const G=(a,b)=>b==0?a:G(b,a%b);

window._gn=function(){
let w=[],l=[],rv=D.querySelector(_(3))[_('10')];
let use_fix = I('sgw').checked;

// Collect WAN Data
Q(_(14)+' '+_(13)).forEach((r,k)=>{
    let id = k+1;
    w.push({
        n: 'ISP'+id, 
        cm: _(33)+'ISP'+id, 
        rm: _(34)+'ISP'+id,
        f: r.querySelector(_(16))[_('10')][_('11')](),
        i: r.querySelector(_(17))[_('10')][_('11')](),
        g: r.querySelector(_(18))[_('10')][_('11')](),
        b: parseInt(r.querySelector(_(19))[_('10')])||1
    });
});

// Collect LAN Data
Q(_(15)+' '+_(13)).forEach(r=>{
l.push({f:r.querySelector(_(20))[_('10')][_('11')](),
i:r.querySelector(_(21))[_('10')][_('11')]()});
});

if(!w[_('12')]||!l[_('12')])return alert(_(22));

// Calculate PCC Ratio
let bs=w.map(x=>x.b),g=bs[0];
for(let i=1;i<bs[_('12')];i++)g=G(bs[i],g);
let T=0;w.forEach(x=>{x.r=x.b/g;T+=x.r});

// Ratio Visual
let ratioText = w.map(x=>x.n + ': ' + x.r + ' Stream(s)').join(' | ');
I('st').innerText='MODE: '+rv.toUpperCase()+' | TOTAL STREAMS: '+T+'\nDISTRIBUTION: '+ratioText;

// Header
let s='# PCC V4.7 ENGINEER GRADE ('+rv.toUpperCase()+')\n# Optimized for clean logic & stability\n\n';
s+='/log info "'+_(30)+'"\n';
s+='/interface list add name='+_(24)+'\n/interface list add name='+_(25)+'\n';

// Address List (Efficient)
s+='\n# DEFINE LOCAL NETWORKS (Bypass Target)\n/ip firewall address-list\n';
l.forEach(x=>{
    let net = x.i; 
    s+='add list='+_(23)+' address='+net+' comment="Local Subnet"\n';
});
// Add standard private ranges for safety
s+='add list='+_(23)+' address=192.168.0.0/16 comment="RFC1918"\n';
s+='add list='+_(23)+' address=10.0.0.0/8 comment="RFC1918"\n';
s+='add list='+_(23)+' address=172.16.0.0/12 comment="RFC1918"\n';

s+='\n# DISABLE FASTTRACK (MANDATORY FOR PCC)\n/ip firewall filter disable [find action='+_(26)+']\n';

// WAN Config
s+='\n# WAN CONFIGURATION\n';
w.forEach(x=>{
    s+='/interface set [find default-name='+x.f+'] name="'+x.f+'"\n';
    s+='/interface list member add interface="'+x.f+'" list='+_(24)+'\n';
    s+='/ip address add address='+x.i+' interface="'+x.f+'" comment="'+x.n+'"\n';
    s+='/ip firewall nat add chain=srcnat out-interface="'+x.f+'" action=masquerade comment="NAT-'+x.n+'"\n';
});

// LAN Config
s+='\n# LAN CONFIGURATION\n';
l.forEach(x=>{
    if(!x.f.toLowerCase().includes('vlan') && !x.f.toLowerCase().includes('bridge')) s+='/interface set [find default-name='+x.f+'] name="'+x.f+'"\n';
    s+='/interface list member add interface="'+x.f+'" list='+_(25)+'\n';
});

// MANGLE - ROUTER TRAFFIC (INPUT/OUTPUT)
s+='\n# MANGLE: ROUTER TRAFFIC CONTROL (Ensures Remote Access Works)\n/ip firewall mangle\n';
w.forEach(x=>{
    s+='add chain=input in-interface="'+x.f+'" action=mark-connection new-connection-mark='+x.cm+' passthrough=yes comment="Sticky Input '+x.n+'"\n';
    s+='add chain=output connection-mark='+x.cm+' action=mark-routing new-routing-mark='+x.rm+' passthrough=no comment="Sticky Output '+x.n+'"\n';
});

// MANGLE - LAN PCC (PREROUTING)
s+='\n# MANGLE: LAN LOAD BALANCING (PCC)\n';
s+='add chain=prerouting dst-address-list='+_(23)+' action=accept comment="Bypass Local Traffic"\n';

let c=0;
w.forEach(x=>{
    for(let k=0;k<x.r;k++){
        s+='add chain=prerouting in-interface-list='+_(25)+' dst-address-list=!'+_(23)+' per-connection-classifier='+_(27)+':'+T+'/'+c+' action=mark-connection new-connection-mark='+x.cm+' passthrough=yes comment="PCC Stream '+c+'->'+x.n+'"\n';
        c++;
    }
});

// FINAL MARK ROUTING
s+='\n# MANGLE: APPLY ROUTING MARKS\n';
w.forEach(x=>{
    s+='add chain=prerouting in-interface-list='+_(25)+' connection-mark='+x.cm+' action=mark-routing new-routing-mark='+x.rm+' passthrough=no comment="Route to '+x.n+'"\n';
});

// ROUTING
if(rv===_(28)){
    s+='\n# ROUTING TABLES (V7 FIB)\n/routing table\n';
    w.forEach(x=>{s+='add name='+x.rm+' fib\n';});
}

s+='\n# IP ROUTES (FAILOVER & CHECK-GATEWAY)\n/ip route\n';
w.forEach(x=>{
    let m=rv===_(28)?'routing-table=':'routing-mark=';
    let suffix = use_fix ? _(32)+x.f : ''; 
    let gw = x.g + suffix;
    
    // Main Route
    s+='add dst-address=0.0.0.0/0 gateway='+gw+' distance=1 '+m+x.rm+' check-gateway=ping comment="Main '+x.n+'"\n';
    
    // Failover Routes
    w.forEach(b=>{
        if(x.n!==b.n){
            let suffixB = use_fix ? _(32)+b.f : '';
            let gwb = b.g + suffixB;
            s+='add dst-address=0.0.0.0/0 gateway='+gwb+' distance=2 '+m+x.rm+' check-gateway=ping comment="Failover to '+b.n+'"\n';
        }
    });
});

// Default Routes (ECMP/Distance)
s+='\n# DEFAULT ROUTES (ROUTER INTERNET)\n';
w.sort((a,b)=>b.b-a.b).forEach((x,i)=>{
    let suffix = use_fix ? _(32)+x.f : '';
    let gw = x.g + suffix;
    s+='add dst-address=0.0.0.0/0 gateway='+gw+' distance='+(i+1)+' check-gateway=ping\n';
});

// Security
s+='\n# SECURITY HARDENING\n/ip firewall filter\nadd chain=input protocol=udp dst-port=53 in-interface-list='+_(24)+' action=drop comment="Drop DNS WAN"\nadd chain=input protocol=tcp dst-port=53 in-interface-list='+_(24)+' action=drop comment="Drop DNS WAN"\n';

I('ou').value=s;
};

window._cp=function(){
let e=I('ou');e.select();navigator.clipboard.writeText(e.value);
alert(_(31));
};
})();
</script>

</body>
</html>
